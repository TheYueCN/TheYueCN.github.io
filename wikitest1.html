<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Portfolio — Wiki (Clone)</title>

    <!-- IMPORTANT: Replace the href below with the path to your portfolio's existing CSS file -->
    <link rel="stylesheet" href="styles.css" />

    <style>
      /* Minimal layout helpers that won't override your main stylesheet */
      :root {
        --gap: 18px;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
      }

      .wiki-shell {
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: var(--gap);
        min-height: 100vh;
        padding: 28px;
      }

      header.wiki-header {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .search-input {
        flex: 1;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ddd;
      }

      .sidebar {
        background: rgba(0, 0, 0, 0.03);
        padding: 14px;
        border-radius: 10px;
        overflow: auto;
      }

      .article-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .article-list a {
        display: block;
        padding: 8px;
        border-radius: 6px;
        text-decoration: none;
      }

      .article-list a.active {
        font-weight: 700;
      }

      .content {
        background: #fff;
        padding: 22px;
        border-radius: 10px;
        min-height: 60vh;
      }

      .controls {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #ccc;
        background: #f7f7f7;
        cursor: pointer;
      }

      .btn.primary {
        background: #0366d6;
        color: #fff;
        border-color: transparent;
      }

      textarea.editor {
        width: 100%;
        min-height: 300px;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-family: monospace;
      }

      @media (max-width: 900px) {
        .wiki-shell {
          grid-template-columns: 1fr;
        }

        .sidebar {
          order: 2;
        }

        .content {
          order: 1;
        }
      }
    </style>
  </head>

  <body>
    <div class="wiki-shell">
      <header class="wiki-header">
        <h1 style="margin: 0; font-size: 20px">📚 Wiki</h1>
        <input
          class="search-input"
          id="search"
          placeholder="Search articles..."
        />
        <div class="controls">
          <button class="btn" id="newBtn">+ New</button>
          <button class="btn primary" id="exportBtn">Export JSON</button>
        </div>
      </header>

      <aside class="sidebar">
        <h3 style="margin-top: 0">Articles</h3>
        <ul class="article-list" id="articleList"></ul>
      </aside>

      <main class="content" id="content">
        <!-- Article content injected here -->
        <div id="viewMode" style="display: block">
          <h2 id="title">Welcome</h2>
          <div id="body"></div>

          <div style="margin-top: 18px; display: flex; gap: 8px">
            <button class="btn" id="editBtn">Edit</button>
            <button class="btn" id="deleteBtn">Delete</button>
          </div>
        </div>

        <div id="editMode" style="display: none">
          <input
            id="editTitle"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 6px;
              border: 1px solid #ddd;
              margin-bottom: 10px;
            "
          />

          <textarea class="editor" id="editBody"></textarea>

          <div style="margin-top: 12px; display: flex; gap: 8px">
            <button class="btn primary" id="saveBtn">Save</button>
            <button class="btn" id="cancelBtn">Cancel</button>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Simple Wiki clone script
      // - Stores articles in localStorage by default
      // - Will attempt to fetch /wiki/articles.json if present
      // - Minimal markdown -> HTML renderer (headings, bold, italic, links, lists)

      const STORAGE_KEY = 'portfolio_wiki_articles_v1';
      let articles = {};
      let current = null;

      // Sample articles (fallback)
      const sample = {
        Welcome: {
          title: 'Welcome',
          body: `# Welcome to my portfolio wiki\n\nThis is a demo **Wikipedia-style** clone you can include in your GitHub Pages portfolio.\n\n- Add articles\n- Edit in-browser\n- Export to JSON for committing back to your repo`,
        },
        Showreel: {
          title: 'Showreel',
          body: `# Showreel\n\nEmbed videos in your portfolio and link them here. Use markdown to add links: [My demo](https://example.com)`,
        },
      };

      // ----- Utils -----
      function saveStorage() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(articles));
      }

      function loadStorage() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          try {
            articles = JSON.parse(raw);
            return true;
          } catch (e) {}
        }
        return false;
      }

      async function tryFetchArticles() {
        try {
          const res = await fetch('/wiki/articles.json');
          if (!res.ok) return false;
          const json = await res.json();
          if (json && typeof json === 'object') {
            articles = json;
            return true;
          }
        } catch (e) {}
        return false;
      }

      function slugify(s) {
        return encodeURIComponent(String(s).replace(/\s+/g, '_'));
      }

      function renderMarkdown(md) {
        if (!md) return '';
        let out = md
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/^###### (.*$)/gim, '<h6>$1</h6>')
          .replace(/^##### (.*$)/gim, '<h5>$1</h5>')
          .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
          .replace(/^### (.*$)/gim, '<h3>$1</h3>')
          .replace(/^## (.*$)/gim, '<h2>$1</h2>')
          .replace(/^# (.*$)/gim, '<h1>$1</h1>')
          .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/gim, '<em>$1</em>')
          .replace(/\[(.*?)\]\((.*?)\)/gim, '<a href="$2" target="_blank" rel="noopener">$1</a>')
          .replace(/^\s*[-*] (.*)$/gim, '<li>$1</li>')
          .replace(/^(?!<h|<ul|<li|<blockquote)(.+)$/gim, '<p>$1</p>');
        return out;
      }

      function buildList(filter) {
        const list = document.getElementById('articleList');
        list.innerHTML = '';

        const keys = Object.keys(articles).sort((a, b) => a.localeCompare(b));

        keys
          .filter((k) => !filter || k.toLowerCase().includes(filter.toLowerCase()))
          .forEach((k) => {
            const li = document.createElement('li');
            const a = document.createElement('a');

            a.href = '#/' + slugify(k);
            a.textContent = k;
            a.addEventListener('click', (e) => {
              e.preventDefault();
              showArticle(k);
            });

            if (current === k) a.classList.add('active');
            li.appendChild(a);
            list.appendChild(li);
          });
      }

      function showArticle(title) {
        if (!articles[title]) return;

        current = title;
        history.replaceState({}, '', '#/' + slugify(title));

        document.getElementById('title').textContent = articles[title].title;
        document.getElementById('body').innerHTML = renderMarkdown(articles[title].body);

        document.getElementById('viewMode').style.display = 'block';
        document.getElementById('editMode').style.display = 'none';

        buildList(document.getElementById('search').value);
      }

      function enterEdit(title) {
        const art = articles[title] || { title: title || '', body: '' };

        document.getElementById('editTitle').value = art.title;
        document.getElementById('editBody').value = art.body;

        document.getElementById('viewMode').style.display = 'none';
        document.getElementById('editMode').style.display = 'block';
      }

      function deleteArticle(title) {
        if (!title || !articles[title]) return;
        if (!confirm(`Delete "${title}"?`)) return;

        delete articles[title];
        saveStorage();

        current = null;
        const keys = Object.keys(articles);

        if (keys.length) showArticle(keys[0]);
        else renderWelcome();
      }

      function renderWelcome() {
        document.getElementById('title').textContent = 'Welcome';
        document.getElementById('body').innerHTML = renderMarkdown(
          'No articles yet. Click "+ New" to create one.'
        );

        document.getElementById('viewMode').style.display = 'block';
        document.getElementById('editMode').style.display = 'none';

        buildList(document.getElementById('search').value);
      }

      // ----- Wire up UI -----
      document
        .getElementById('search')
        .addEventListener('input', (e) => buildList(e.target.value));

      document.getElementById('newBtn').addEventListener('click', () => {
        enterEdit('New Article');
      });

      document.getElementById('editBtn').addEventListener('click', () => {
        if (current) enterEdit(current);
        else enterEdit('New Article');
      });

      document.getElementById('cancelBtn').addEventListener('click', () => {
        if (current) showArticle(current);
        else renderWelcome();
      });

      document.getElementById('saveBtn').addEventListener('click', () => {
        const title = document.getElementById('editTitle').value.trim();
        const body = document.getElementById('editBody').value;

        if (!title) {
          alert('Please provide a title');
          return;
        }

        articles[title] = { title, body };
        saveStorage();
        showArticle(title);
      });

      document.getElementById('deleteBtn').addEventListener('click', () => {
        if (current) deleteArticle(current);
      });

      document.getElementById('exportBtn').addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(articles, null, 2)], {
          type: 'application/json',
        });

        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');

        a.href = url;
        a.download = 'articles.json';
        a.click();

        URL.revokeObjectURL(url);
      });

      function checkHash() {
        const h = decodeURIComponent(location.hash.slice(2));

        if (h) {
          const title = Object.keys(articles).find(
            (k) => slugify(k) === encodeURIComponent(h.replace(/_/g, '_'))
          );

          if (title) {
            showArticle(title);
            return;
          }
        }

        const keys = Object.keys(articles);
        if (keys.length) showArticle(keys[0]);
        else renderWelcome();
      }

      (async function init() {
        const fetched = await tryFetchArticles();
        const fromStorage = loadStorage();

        if (!fetched && !fromStorage) articles = sample;

        if (!Object.keys(articles).length) articles = sample;

        buildList('');
        checkHash();
      })();

      window.addEventListener('hashchange', checkHash);
    </script>
  </body>
</html>
